<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Time Pattern Predictor</title>
  <style>
    :root{--bg:#0f1724;--card:#111827;--muted:#9ca3af;--accent:#60a5fa}
    *{box-sizing:border-box;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial}
    body{background:linear-gradient(180deg,#071029 0%, #07121a 100%);color:#e6eef8;margin:0;padding:24px}
    .wrap{max-width:920px;margin:0 auto}
    header{display:flex;align-items:center;gap:16px;margin-bottom:18px}
    h1{font-size:18px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}

    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 20px rgba(2,6,23,0.6);}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:14px}
    textarea{width:100%;min-height:240px;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;font-size:13px}
    label{display:block;font-size:12px;margin-bottom:6px;color:var(--muted)}
    .controls{display:flex;gap:8px;margin-top:8px}
    button{background:var(--accent);border:0;padding:8px 10px;border-radius:10px;color:#06202b;font-weight:600;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .small{font-size:13px;padding:6px 8px}

    table{width:100%;border-collapse:collapse;margin-top:10px}
    th,td{padding:8px 6px;text-align:left;border-bottom:1px dashed rgba(255,255,255,0.03);font-size:13px}
    th{color:var(--muted);font-weight:600}
    .result{margin-top:12px;padding:10px;border-radius:10px;background:linear-gradient(90deg, rgba(96,165,250,0.08), rgba(96,165,250,0.03));color:#dbeafe}
    .pred{font-size:20px;font-weight:700}

    .muted{color:var(--muted)}
    .inline{display:flex;gap:8px;align-items:center}
    .spark{height:48px;margin-top:10px}

    footer{margin-top:14px;color:var(--muted);font-size:12px}

    @media (max-width:880px){.grid{grid-template-columns:1fr;}.card{padding:12px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Time Pattern Predictor</h1>
        <p class="lead">Paste times (one per line) in <code>HH:MM:SS</code>. The tool computes gaps and predicts the next time using a simple alternating-gap heuristic.</p>
      </div>
    </header>

    <div class="grid">
      <div class="card">
        <label>Times (one per line)</label>
        <textarea id="timesInput" placeholder="10:23:36\n10:24:56\n10:27:27\n10:29:07"></textarea>
        <div class="controls">
          <button id="calcBtn">Calculate & Predict</button>
          <button id="addNow" class="ghost small">Add Current Time</button>
          <button id="clearBtn" class="ghost small">Clear</button>
          <button id="copyBtn" class="ghost small">Copy Prediction</button>
        </div>

        <div id="output" style="margin-top:12px"></div>
      </div>

      <div>
        <div class="card">
          <label>Gaps (seconds)</label>
          <div id="gapsArea">No data yet.</div>
          <div class="spark" id="sparkArea"></div>
          <div class="result" id="resultArea" style="display:none">
            <div class="inline"><div class="muted">Last time:</div><div id="lastTime" style="margin-left:6px;font-weight:700"></div></div>
            <div class="inline" style="margin-top:8px"><div class="muted">Predicted next time:</div><div id="predTime" class="pred" style="margin-left:8px"></div></div>
            <div class="muted" style="margin-top:8px;font-size:13px" id="algoNote"></div>
          </div>
        </div>

        <div style="height:12px"></div>
        <div class="card" style="padding:10px">
          <div class="muted">How it predicts (simple heuristic):</div>
          <ul style="margin:8px 0 0 18px;color:var(--muted)">
            <li>Compute gaps in seconds between consecutive times.</li>
            <li>Find median gap. Classify gaps &lt;= median as "low" and &gt; median as "high".</li>
            <li>Compute average low and average high.</li>
            <li>If last gap was low → predict next gap = avg_high; else predict next gap = avg_low.</li>
          </ul>
        </div>
      </div>
    </div>

    <footer>Made for quick predictions. It's a heuristic — not guaranteed. Tweak as you like.</footer>
  </div>

  <script>
    // Utilities
    function parseTimeToSeconds(t){
      // Accepts H:MM:SS or HH:MM:SS. Returns seconds since 00:00:00 (not date-aware)
      if(!t) return null;
      t = t.trim();
      const parts = t.split(':').map(x=>x.trim());
      if(parts.length !== 3) return null;
      const h = parseInt(parts[0],10);
      const m = parseInt(parts[1],10);
      const s = parseInt(parts[2],10);
      if(Number.isNaN(h)||Number.isNaN(m)||Number.isNaN(s)) return null;
      return h*3600 + m*60 + s;
    }
    function secondsToHMS(sec){
      sec = Math.round(sec);
      sec = ((sec % 86400) + 86400) % 86400; // wrap in day
      const h = Math.floor(sec/3600);
      const m = Math.floor((sec%3600)/60);
      const s = sec%60;
      return [h,m,s].map(x=>String(x).padStart(2,'0')).join(':');
    }

    function median(arr){
      if(!arr.length) return 0;
      const a = arr.slice().sort((x,y)=>x-y);
      const mid = Math.floor(a.length/2);
      return a.length%2 ? a[mid] : (a[mid-1]+a[mid])/2;
    }

    // Main logic
    function computePrediction(times){
      // times: array of strings 'HH:MM:SS' in chronological order
      const secs = times.map(parseTimeToSeconds).filter(x=>x!==null);
      if(secs.length < 2) return {error:'Enter at least 2 valid times.'};
      // compute gaps
      const gaps = [];
      for(let i=1;i<secs.length;i++){
        gaps.push(secs[i]-secs[i-1]);
      }
      const med = median(gaps);
      const lows = gaps.filter(g=>g<=med);
      const highs = gaps.filter(g=>g>med);
      const avgLow = lows.length? Math.round(lows.reduce((a,b)=>a+b,0)/lows.length): Math.round(med*0.9);
      const avgHigh = highs.length? Math.round(highs.reduce((a,b)=>a+b,0)/highs.length): Math.round(med*1.3);
      const lastGap = gaps[gaps.length-1];
      const predictedGap = (lastGap <= med) ? avgHigh : avgLow;
      const lastTimeSec = secs[secs.length-1];
      const predictedTimeSec = lastTimeSec + predictedGap;
      return {
        gaps, med, avgLow, avgHigh, lastGap, predictedGap, lastTimeSec, predictedTimeSec
      };
    }

    // UI wiring
    const timesInput = document.getElementById('timesInput');
    const calcBtn = document.getElementById('calcBtn');
    const output = document.getElementById('output');
    const gapsArea = document.getElementById('gapsArea');
    const resultArea = document.getElementById('resultArea');
    const lastTimeEl = document.getElementById('lastTime');
    const predTimeEl = document.getElementById('predTime');
    const algoNote = document.getElementById('algoNote');
    const sparkArea = document.getElementById('sparkArea');
    const addNow = document.getElementById('addNow');
    const clearBtn = document.getElementById('clearBtn');
    const copyBtn = document.getElementById('copyBtn');

    function renderResult(obj, rawTimes){
      if(obj.error){ output.innerHTML = '<div class="muted">'+obj.error+'</div>'; gapsArea.innerHTML='No data.'; resultArea.style.display='none'; return; }
      // Gaps table
      let html = '<table><thead><tr><th>#</th><th>Time</th><th>Gap (s)</th></tr></thead><tbody>';
      const secs = rawTimes.map(parseTimeToSeconds).filter(x=>x!==null);
      for(let i=0;i<secs.length;i++){
        const t = secondsToHMS(secs[i]);
        const g = i===0? '-' : obj.gaps[i-1];
        html += `<tr><td>${i+1}</td><td>${t}</td><td>${g}</td></tr>`;
      }
      html += '</tbody></table>';
      gapsArea.innerHTML = html;

      // spark (simple svg bars)
      const maxGap = Math.max(...obj.gaps, 1);
      let svg = `<svg width="100%" height="48" viewBox="0 0 200 48" preserveAspectRatio="none">`;
      const barW = Math.max(6, Math.floor(200/Math.max(1,obj.gaps.length)) - 2);
      obj.gaps.forEach((g,i)=>{
        const h = Math.round((g/maxGap)*36)+6;
        const x = i*(barW+4);
        svg += `<rect x="${x}" y="${48-h-4}" width="${barW}" height="${h}" rx="2" fill="rgba(96,165,250,0.9)" />`;
      });
      svg += `</svg>`;
      sparkArea.innerHTML = svg;

      // result area
      lastTimeEl.textContent = secondsToHMS(obj.lastTimeSec);
      predTimeEl.textContent = secondsToHMS(obj.predictedTimeSec);
      algoNote.textContent = `median=${Math.round(obj.med)}s · avgLow=${obj.avgLow}s · avgHigh=${obj.avgHigh}s · lastGap=${obj.lastGap}s · predictedGap=${obj.predictedGap}s`;
      resultArea.style.display = 'block';

      output.innerHTML = '';
    }

    calcBtn.addEventListener('click', ()=>{
      const raw = timesInput.value.split('\n').map(x=>x.trim()).filter(x=>x);
      const res = computePrediction(raw);
      renderResult(res, raw);
    });

    addNow.addEventListener('click', ()=>{
      const now = new Date();
      const hh = String(now.getHours()).padStart(2,'0');
      const mm = String(now.getMinutes()).padStart(2,'0');
      const ss = String(now.getSeconds()).padStart(2,'0');
      const line = `${hh}:${mm}:${ss}`;
      const cur = timesInput.value.trim();
      timesInput.value = cur ? (cur + '\n' + line) : line;
    });

    clearBtn.addEventListener('click', ()=>{
      timesInput.value = '';
      gapsArea.innerHTML = 'No data yet.';
      output.innerHTML = '';
      resultArea.style.display = 'none';
      sparkArea.innerHTML = '';
    });

    copyBtn.addEventListener('click', ()=>{
      const pred = document.getElementById('predTime').textContent;
      if(!pred) return;
      navigator.clipboard.writeText(pred).then(()=>{
        copyBtn.textContent = 'Copied!';
        setTimeout(()=>copyBtn.textContent='Copy Prediction',900);
      });
    });

    // quick demo data
    timesInput.value = `10:23:36\n10:24:56\n10:27:27\n10:29:07\n10:31:16\n10:32:55\n10:34:17\n10:36:44\n10:41:25`;
    // auto-calc on load
    setTimeout(()=>calcBtn.click(),200);
  </script>
</body>
</html>
